@startuml Test Structure
!theme plain
skinparam backgroundColor #FEFEFE

title IFA Test-Driven Development Structure

package "tests/" as tests {

    package "unit/" as unit {
        note as unitNote
            Fast, isolated tests
            Mock all dependencies
            Run on every commit
        end note

        package "services/" as unitServices {
            [auth.test.ts] as authTest
            [etsy-oauth.test.ts] as oauthTest
            [etsy-sync.test.ts] as syncTest
            [provisioner.test.ts] as provTest
            [gateway.test.ts] as gatewayTest
        }

        package "skills/" as unitSkills {
            [inventory-analysis.test.ts] as invTest
            [registry.test.ts] as regTest
        }

        package "utils/" as unitUtils {
            [crypto.test.ts] as cryptoTest
            [id.test.ts] as idTest
        }

        package "middleware/" as unitMw {
            [auth.test.ts] as authMwTest
            [rate-limiter.test.ts] as rateTest
        }
    }

    package "integration/" as integration {
        note as intNote
            Test component interactions
            Use test database
            Run before merge
        end note

        [auth-flow.test.ts] as authFlowTest
        [etsy-oauth-flow.test.ts] as oauthFlowTest
        [product-sync-flow.test.ts] as syncFlowTest
        [agent-lifecycle.test.ts] as agentFlowTest
        [skill-execution.test.ts] as skillFlowTest
        [queue-worker.test.ts] as workerTest
    }

    package "e2e/" as e2e {
        note as e2eNote
            Full user journey tests
            Real API calls (staging)
            Run before release
        end note

        [seller-onboarding.test.ts] as onboardTest
        [etsy-connection.test.ts] as etsyTest
        [agent-messaging.test.ts] as msgTest
        [dashboard-api.test.ts] as dashTest
    }

    [setup.ts] as setup
    [helpers.ts] as helpers
    [fixtures/] as fixtures
}

' Dependencies
unitServices ..> helpers : uses
integration ..> setup : database setup
integration ..> fixtures : test data
e2e ..> setup : env setup

@enduml
