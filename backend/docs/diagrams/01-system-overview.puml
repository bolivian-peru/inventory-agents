@startuml IFA System Overview
!theme plain
skinparam backgroundColor #FEFEFE
skinparam componentStyle rectangle

title IFA - Inventory For Agents\nSystem Architecture Overview

' Actors
actor "Etsy Seller" as seller #LightBlue
actor "Customer" as customer #LightGreen

' External Systems
cloud "Etsy API" as etsy #Orange
cloud "WhatsApp" as whatsapp #25D366
cloud "Telegram" as telegram #0088CC
cloud "Anthropic API" as anthropic #D4A574

' Frontend
package "Frontend (Vercel)" as frontend #LightYellow {
    [Landing Page] as landing
    [Dashboard] as dashboard
    [Etsy OAuth UI] as oauthui
}

' Backend
package "Backend (Hetzner VPS)" as backend #LightCyan {
    package "API Layer" as api {
        [Hono.js Server] as hono
        [Auth Middleware] as auth
        [Rate Limiter] as ratelimit
    }

    package "Services" as services {
        [Auth Service] as authsvc
        [Etsy OAuth] as etsyoauth
        [Product Sync] as productsync
        [Agent Provisioner] as provisioner
        [Skills Engine] as skills
    }

    package "Data Layer" as data {
        database "PostgreSQL" as postgres
        database "Redis" as redis
    }

    package "Agent Runtime" as runtime {
        [OpenClaw Gateway] as openclaw
        [Queue Worker] as worker
        folder "Workspaces" as workspaces {
            [Seller A Workspace] as ws_a
            [Seller B Workspace] as ws_b
        }
    }
}

' Relationships - User Flows
seller --> landing : visits
seller --> dashboard : manages
seller --> oauthui : connects Etsy

' Frontend to Backend
dashboard --> hono : REST API
oauthui --> etsyoauth : OAuth flow

' Backend internal
hono --> auth : validates JWT
hono --> ratelimit : checks limits
auth --> authsvc : login/register
etsyoauth --> etsy : OAuth 2.0 + PKCE
productsync --> etsy : fetch listings
provisioner --> workspaces : creates
skills --> workspaces : injects prompts

' Data
authsvc --> postgres : users
etsyoauth --> postgres : tokens (encrypted)
productsync --> postgres : products
ratelimit --> redis : counters
worker --> postgres : job queue

' Agent Runtime
worker --> openclaw : sends messages
openclaw --> workspaces : routes to agent
openclaw --> anthropic : Claude API
openclaw --> whatsapp : Baileys
openclaw --> telegram : grammY

' Customer interaction
customer --> whatsapp : asks question
customer --> telegram : asks question
whatsapp --> openclaw : incoming message
telegram --> openclaw : incoming message

' Notes
note right of workspaces
  Each seller gets isolated workspace:
  ~/.openclaw/workspaces/seller_{id}/
  ├── CLAUDE.md (system prompt)
  ├── SOUL.md (seller instructions)
  ├── .mcp.json (Etsy MCP config)
  ├── products/ (inventory)
  └── skills/ (analysis prompts)
end note

note bottom of anthropic
  Requires Claude Pro/Team
  subscription ($20/mo)
end note

@enduml
